name: Build and release application

on:
  branches:
    - main
    - 'releases/v**'

jobs:
  build:
    name: Build the app
    runs-on: windows-latest

    steps:
    - name: Checkout source code
      uses: actions/checkout@v2
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 6.0.x
    
    - name: Restore dependencies
      working-directory: src/VoicemodPowertools
      run: dotnet restore
    
    - name: Build
      working-directory: src/VoicemodPowertools
      run: dotnet build -c release --no-restore
      
    - name: Upload a Build Artifact
      uses: actions/upload-artifact@v2.2.2
      with:
        # Artifact name
        name: TestDownloadableArtifact #.zip will be added automatically
        path: src/VoicemodPowertools/bin/release/net6.0/*.*

          - name: release
            uses: actions/create-release@v1
            id: create_release
            with:
              draft: false
              prerelease: false
              release_name: ${{ steps.version.outputs.version }}
              tag_name: ${{ github.ref }}
              body_path: CHANGELOG.md
            env:
              GITHUB_TOKEN: ${{ github.token }}
#    - name: "Determine tag"
#      run: |
#          echo \"RELEASE_TAG=${GITHUB_REF#refs/tags/}\" >> $GITHUB_ENV
#          $upload_url=$(curl -sL https://api.github.com/repos/actions/checkout/releases/latest | jq -r '.upload_url')
#          echo $upload_url
#          echo \"UPLOAD_URL=$upload_url\" >> $GITHUB_ENV
#
#    - name: 'Upload artifact'
#      uses: actions/upload-release-asset@v1
#      with:
#        upload_url: ${{ env.UPLOAD_URL }}
